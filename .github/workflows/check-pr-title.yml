name: Check PR Title

on:
  pull_request:
    types: [opened, edited]

jobs:
  check-conventions:
    runs-on: ubuntu-latest

    steps:
      - name: 🔍 Check PR title
        run: |
          BRANCH="${{ github.head_ref }}"
          TITLE="${{ github.event.pull_request.title }}"
          echo "🔎 Branch: $BRANCH"
          echo "🔎 Title: $TITLE"
          # Extract number after slash — e.g. feat/123_abc → 123
          RAW_NAME=$(echo "$BRANCH" | cut -d'/' -f2)
          TICKET=$(echo "$RAW_NAME" | grep -oE '^[0-9]+')

          if [[ -z "$TICKET" ]]; then
            echo "❌ Cannot extract ticket number from branch name"
            exit 1
          fi

          if [[ "$TITLE" != "$TICKET:"* ]] && [[ "$TITLE" != "[WIP]"*"$TICKET:"* ]]; then
            echo "❌ PR title must start with '$TICKET: ' or '[WIP]'"
            echo "🔁 Example: '$TICKET: your feature description' or '[WIP] your work in progress'"
            exit 1
          fi

          if [[ "$TITLE" == "[WIP]"* ]]; then
            echo "✅ PR title starts with '[WIP]' - work in progress"
          else
            echo "✅ PR title starts with ticket number '$TICKET'"
          fi
          echo "✅ PR title is valid."
