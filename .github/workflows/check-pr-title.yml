name: Check PR Title

on:
  pull_request:
    types: [opened, edited]

jobs:
  check-conventions:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Check PR title
        run: |
          BRANCH="${{ github.head_ref }}"
          TITLE="${{ github.event.pull_request.title }}"
          echo "ğŸ” Branch: $BRANCH"
          echo "ğŸ” Title: $TITLE"
          # Extract number after slash â€” e.g. feat/123_abc â†’ 123
          RAW_NAME=$(echo "$BRANCH" | cut -d'/' -f2)
          TICKET=$(echo "$RAW_NAME" | grep -oE '^[0-9]+')

          if [[ -z "$TICKET" ]]; then
            echo "âŒ Cannot extract ticket number from branch name"
            exit 1
          fi

          if [[ "$TITLE" != "$TICKET:"* ]] && [[ "$TITLE" != "[WIP]"*"$TICKET:"* ]]; then
            echo "âŒ PR title must start with '$TICKET: ' or '[WIP]'"
            echo "ğŸ” Example: '$TICKET: your feature description' or '[WIP] your work in progress'"
            exit 1
          fi

          if [[ "$TITLE" == "[WIP]"* ]]; then
            echo "âœ… PR title starts with '[WIP]' - work in progress"
          else
            echo "âœ… PR title starts with ticket number '$TICKET'"
          fi
          echo "âœ… PR title is valid."
